generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Team {
  TeamId            Int             @id @default(autoincrement())
  TeamName          String          @db.Text
  TeamDescription   String          @db.LongText
  PublicPermLevelId Int
  TeamOrganizers    User[]          @relation("TeamOrganizers")
  TeamMembers       User[]          @relation("TeamMembers")
  TeamTickets       Ticket[]        @relation("TeamTickets")
  PublicPermLevel   PermissionLevel @relation("PublicPermLevel", fields: [PublicPermLevelId], references: [PermissionLevelId])

  @@index([PublicPermLevelId])
}

model PermissionLevel {
  PermissionLevelId   Int    @id @default(autoincrement())
  PermissionLevelName String @db.Text
  PermissionLevel     Int    @default(0)
  VisibleTeams        Team[] @relation("PublicPermLevel")
  PermissionedUsers   User[] @relation("PermissionLevel")
}

model User {
  UserId                   Int              @id @default(autoincrement())
  UserEmail                String           @db.VarChar(600) @unique
  UserPassword             String           @db.Text 
  UserName                 String           @db.MediumText
  CurrentPermissionLevelId Int
  CurrentPermissionLevel   PermissionLevel? @relation("PermissionLevel", fields: [CurrentPermissionLevelId], references: [PermissionLevelId])
  UserAuthoredTickets      Ticket[]         @relation("AuthoredTickets")
  UserAssignedTickets      Ticket[]         @relation("AssignedTickets")
  UserSession              Session[]        @relation("UserSession")
  UserTeams                Team[]           @relation("TeamMembers")
  OrganizedTeams           Team[]           @relation("TeamOrganizers")

  @@index([CurrentPermissionLevelId])
}

model TicketType {
  TicketTypeId   Int      @id @default(autoincrement())
  TicketTypeName String   @db.Text
  TicketsOfType  Ticket[] @relation("TicketType")
}

model TicketStatus {
  TicketStatusId   Int      @id @default(autoincrement())
  TicketStatusName String   @db.Text
  TicketsOfStatus  Ticket[] @relation("TicketStatus")
}

model Ticket {
  ticketId              Int          @id @default(autoincrement())
  AuthorUserId          Int          @unique
  CurrentAssignedUserId Int          @unique
  CurrentTicketStatusId Int
  CurrentTicketTypeId   Int
  TicketTitle           String       @default("ticket title")
  TicketBody            String       @default("Ticket description")
  TicketCreationTime    DateTime     @default(now())
  TicketTeamId          Int
  AuthorUser            User         @relation("AuthoredTickets", fields: [AuthorUserId], references: [UserId])
  CurrentAssignedUser   User?        @relation("AssignedTickets", fields: [CurrentAssignedUserId], references: [UserId])
  TicketStatus          TicketStatus @relation("TicketStatus", fields: [CurrentTicketStatusId], references: [TicketStatusId])
  TicketType            TicketType   @relation("TicketType", fields: [CurrentTicketTypeId], references: [TicketTypeId])
  Team                  Team         @relation("TeamTickets", fields: [TicketTeamId], references: [TeamId])

  @@index([AuthorUserId])
  @@index([CurrentAssignedUserId])
  @@index([CurrentTicketTypeId])
  @@index([CurrentTicketStatusId])
  @@index([TicketTeamId])
}

model Session {
  sessionId       Int    @id @default(autoincrement())
  SessionToken    String @default("")
  SessionedUserId Int    
  sessionedUser   User   @relation("UserSession", fields: [SessionedUserId], references: [UserId])

  @@index([SessionedUserId])
}

model TeamMembers {
  A Int
  B Int

  @@unique([A, B], map: "_TeamMembers_AB_unique")
  @@index([B], map: "_TeamMembers_B_index")
  @@map("_TeamMembers")
}

model TeamOrganizers {
  A Int
  B Int

  @@unique([A, B], map: "_TeamOrganizers_AB_unique")
  @@index([B], map: "_TeamOrganizers_B_index")
  @@map("_TeamOrganizers")
}
